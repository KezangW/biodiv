/*! Leaflet.Coordinates 04-06-2013 */
L.Control.Coordinates=L.Control.extend({options:{position:"bottomright",decimals:4,decimalSeperator:".",labelTemplateLat:"Lat: {y}",labelTemplateLng:"Lng: {x}",enableUserInput:!0},onAdd:function(a){this._map=a;var b="leaflet-control-coordinates",c=this._container=L.DomUtil.create("div",b),d=this.options;return this._labelcontainer=L.DomUtil.create("div","uiElement label",c),this._labelX=L.DomUtil.create("span","labelX",this._labelcontainer),this._labelY=L.DomUtil.create("span","labelY",this._labelcontainer),this._inputcontainer=L.DomUtil.create("div","uiElement input uiHidden",c),L.DomUtil.create("span","",this._inputcontainer).innerHTML=d.labelTemplateLng.replace("{x}",""),this._inputX=this._createInput("inputX",this._inputcontainer),L.DomUtil.create("span","",this._inputcontainer).innerHTML=d.labelTemplateLat.replace("{y}",""),this._inputY=this._createInput("inputY",this._inputcontainer),L.DomEvent.on(this._inputX,"keyup",this._handleKeypress,this),L.DomEvent.on(this._inputY,"keyup",this._handleKeypress,this),a.on("mousemove",this._update,this),a.on("dragstart",this.collapse,this),a.whenReady(this._update,this),this._showsCoordinates=!0,d.enableUserInput&&L.DomEvent.addListener(this._container,"click",this._switchUI,this),c},_createInput:function(a,b){var c=L.DomUtil.create("input",a,b);return c.type="text",L.DomEvent.disableClickPropagation(c),c},_clearMarker:function(){this._map.removeLayer(this._marker)},_handleKeypress:function(a){switch(a.keyCode){case 27:this.collapse();break;case 13:this._handleSubmit(),this.collapse();break;default:this._handleSubmit()}},_handleSubmit:function(){var a=this._createValidInput(this._inputX.value),b=this._createValidInput(this._inputY.value);if(void 0!==a&&void 0!==b){if(!this._marker){var c=this._marker=L.marker();c.on("click",this._clearMarker,this)}this._marker.setLatLng(new L.LatLng(b,a)),this._marker.addTo(this._map)}},_createValidInput:function(a){if(a&&a.length>0){var b=a.split(this.options.decimalSeperator);try{var c=Number(b.join("."));return isNaN(c)?void 0:c}catch(d){return void 0}}return void 0},expand:function(){this._showsCoordinates=!1,map.off("mousemove",this._update,this),L.DomEvent.addListener(this._container,"mousemove",L.DomEvent.stop),L.DomEvent.removeListener(this._container,"click",this._switchUI,this),L.DomUtil.addClass(this._labelcontainer,"uiHidden"),L.DomUtil.removeClass(this._inputcontainer,"uiHidden")},collapse:function(){if(!this._showsCoordinates){map.on("mousemove",this._update,this),this._showsCoordinates=!0;var a=this.options;if(L.DomEvent.addListener(this._container,"click",this._switchUI,this),L.DomEvent.removeListener(this._container,"mousemove",L.DomEvent.stop),L.DomUtil.addClass(this._inputcontainer,"uiHidden"),L.DomUtil.removeClass(this._labelcontainer,"uiHidden"),this._marker){var b=L.marker(),c=this._marker.getLatLng();b.setLatLng(c);var d=L.DomUtil.create("div",""),e=L.DomUtil.create("div","",d);e.innerHTML=labelX=L.Util.template(a.labelTemplateLng,{x:c.lng})+" "+L.Util.template(a.labelTemplateLat,{y:c.lat});var f=L.DomUtil.create("a","",d);f.innerHTML="Remove",f.href="#",L.DomEvent.addListener(f,"click",function(){this._map.removeLayer(b)},this),b.bindPopup(d),b.addTo(this._map),this._map.removeLayer(this._marker),this._marker=null}}},_switchUI:function(a){L.DomEvent.stop(a),L.DomEvent.stopPropagation(a),L.DomEvent.preventDefault(a),this._showsCoordinates?this.expand():this.collapse()},onRemove:function(a){a.off("mousemove",this._update,this)},_update:function(a){var b=a.latlng,c="",d="",e=this.options,f="",g="";b&&(this._currentPos=b,g=this._getRoundNum(b.lat),f=this._getRoundNum(b.lng),this._inputX.value=f,this._inputY.value=g),d=L.Util.template(e.labelTemplateLat,{y:g}),c=L.Util.template(e.labelTemplateLng,{x:f}),this._labelX.innerHTML=c,this._labelY.innerHTML=d},_getRoundNum:function(a){var b=this.options,c=b.decimals,d=L.Util.formatNum(a,c)+"",e=d.split(".");if(e[1]){for(var f=c-e[1].length;f>0;f--)e[1]+="0";d=e.join(b.decimalSeperator)}return d}}),L.control.coordinates=function(a){return new L.Control.Coordinates(a)};